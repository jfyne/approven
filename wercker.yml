deploy:
  box: 
    id: google/cloud-sdk
    tag: latest
  steps:
    - script:
      name: activate service account
      code: |
        echo $GOOGLE_JSON >> secret.json
        CLOUDSDK_PYTHON_SITEPACKAGES=1 gcloud auth activate-service-account $GOOGLE_ACCOUNT --key-file secret.json
    - script:
      name: upload to gs
      code: |
        # Sync
        gsutil -m rsync -r -d public gs://www.approven.com
        # Create gz files
        gsutil -m cp -r -z html,css,js,xml,txt,json,map,svg / gs://www.approven.com


  - narinari/gcs-website-deploy:
    bucket:   www.approven.com
    project:  essential-oasis-144121
    access_key_id:    geoff-beachead-com%40essential-oasis-144121.iam.gserviceaccount.com
    secret_access_key:    $GCS_SECRET_ACCESS_KEY
